{"version":3,"file":"admin.js","mappings":"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","sources":["webpack://@nodeloc/flarum-ext-referral/webpack/bootstrap","webpack://@nodeloc/flarum-ext-referral/webpack/runtime/compat get default export","webpack://@nodeloc/flarum-ext-referral/webpack/runtime/define property getters","webpack://@nodeloc/flarum-ext-referral/webpack/runtime/hasOwnProperty shorthand","webpack://@nodeloc/flarum-ext-referral/webpack/runtime/make namespace object","webpack://@nodeloc/flarum-ext-referral/external root \"flarum.core.compat['admin/app']\"","webpack://@nodeloc/flarum-ext-referral/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@nodeloc/flarum-ext-referral/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@nodeloc/flarum-ext-referral/external root \"flarum.core.compat['common/Model']\"","webpack://@nodeloc/flarum-ext-referral/./src/common/models/FreeCodeListItem.js","webpack://@nodeloc/flarum-ext-referral/external root \"flarum.core.compat['admin/components/ExtensionPage']\"","webpack://@nodeloc/flarum-ext-referral/external root \"flarum.core.compat['common/components/Button']\"","webpack://@nodeloc/flarum-ext-referral/external root \"flarum.core.compat['common/components/Dropdown']\"","webpack://@nodeloc/flarum-ext-referral/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@nodeloc/flarum-ext-referral/external root \"flarum.core.compat['common/models/Group']\"","webpack://@nodeloc/flarum-ext-referral/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@nodeloc/flarum-ext-referral/./src/admin/FreeListConfigurator.js","webpack://@nodeloc/flarum-ext-referral/./src/admin/FreeListSettingPage.js","webpack://@nodeloc/flarum-ext-referral/./src/admin/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/app'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","import Model from 'flarum/common/Model';\n\nexport default class FreeCodeListItem extends Model {\n  days = Model.attribute('days');\n  amount = Model.attribute('amount');\n  group = Model.hasOne('group');\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/components/ExtensionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Dropdown'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Group'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","import Button from 'flarum/common/components/Button';\nimport Dropdown from 'flarum/common/components/Dropdown';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport Group from 'flarum/common/models/Group';\nimport icon from 'flarum/common/helpers/icon';\n\n/* global app, m */\n\nconst translationPrefix = 'nodeloc-referral.admin.items.';\n\nexport default class SelectFieldOptionEditor {\n  oninit() {\n    this.items = null;\n    app.request({\n      method: 'GET',\n      url: app.forum.attribute('apiUrl') + '/freecode-list',\n    }).then(response => {\n      this.items = app.store.pushPayload(response);\n      m.redraw();\n    });\n  }\n\n  view() {\n    const existingGroups = this.items === null ? [] : this.items.map(item => item.group().id());\n    return m('table.FreeListTable', m('tbody', [\n      this.items === null ? m('tr', m('td', LoadingIndicator.component())) : this.items.map((item, index) => m('tr', [\n        m('td', item.group().namePlural()),\n        m('td', m('input.FormControl', {\n          type: 'number',\n          min: 0,\n          step: 'any',\n          onchange: event => {\n            item.save({\n              days: event.target.value,\n            }).then(() => {\n              m.redraw();\n            });\n          },\n          value: item.days(),\n        })),\n        m('td', m('input.FormControl', {\n          type: 'number',\n          min: 0,\n          step: 'any',\n          onchange: event => {\n            item.save({\n              amount: event.target.value,\n            }).then(() => {\n              m.redraw();\n            });\n          },\n          value: item.amount(),\n        })),\n        m('td', m('button.Button.Button--danger', {\n          onclick: event => {\n            event.preventDefault(); // Do not close the settings modal\n            item.delete().then(() => {\n              this.items.splice(index, 1);\n              m.redraw();\n            });\n          },\n        }, icon('fas fa-times'))),\n      ])),\n      m('tr', m('td', {\n        colspan: 5,\n      }, Dropdown.component({\n        label: app.translator.trans(translationPrefix + 'add'),\n        buttonClassName: 'Button',\n      }, app.store.all('groups')\n        .filter(group => {\n          if (group.id() === Group.MEMBER_ID || group.id() === Group.GUEST_ID) {\n            // Do not suggest \"virtual\" groups\n            return false;\n          }\n\n          // Do not suggest groups already in use\n          return existingGroups.indexOf(group.id()) === -1;\n        })\n        .map(group => Button.component({\n          onclick: () => {\n            app.request({\n              method: 'POST',\n              url: app.forum.attribute('apiUrl') + '/freecode-list-items',\n              body: {\n                data: {\n                  attributes: {\n                    groupId: group.id()\n                  },\n                },\n              },\n            }).then(response => {\n              this.items.push(app.store.pushPayload(response));\n              m.redraw();\n            });\n          },\n        }, group.namePlural()))))),\n    ]));\n  }\n}\n","import ExtensionPage from 'flarum/admin/components/ExtensionPage';\nimport FreeListConfigurator from './FreeListConfigurator';\n\nexport default class FreeListSettingPage extends ExtensionPage {\n  content() {\n    return m('.ExtensionPage-settings',\n      m('.container', [\n        super.content(), // 继承默认的 registerSetting 内容\n        m('.Form-group', m(FreeListConfigurator)), // 你自定义的组件\n      ])\n    );\n  }\n}\n","// @ts-ignore\nimport app from 'flarum/admin/app';\nimport FreeCodeListItem from \"../common/models/FreeCodeListItem\";\nimport FreeListSettingPage from \"./FreeListSettingPage\";\napp.initializers.add('nodeloc/flarum-ext-referral', () => {\n  app.store.models['freecode-list-items'] = FreeCodeListItem;\n  app.extensionData\n    .for('nodeloc-referral')\n    .registerSetting({\n      setting: 'nodeloc-flarum-ext-referral.price',\n      label: app.translator.trans('nodeloc-referral.admin.settings.price'),\n      type: 'number',\n    })\n    .registerSetting({\n      setting: 'nodeloc-flarum-ext-referral.reward',\n      label: app.translator.trans('nodeloc-referral.admin.settings.reward'),\n      type: 'number',\n    })\n    .registerSetting({\n      setting: 'nodeloc-flarum-ext-referral.max_number',\n      label: app.translator.trans('nodeloc-referral.admin.settings.max_number'),\n      type: 'number',\n    })\n    .registerSetting({\n      setting: 'nodeloc-flarum-ext-referral.expires',\n      label: app.translator.trans('nodeloc-referral.admin.settings.expires'),\n      type: 'number',\n    })\n    .registerSetting({\n      setting: 'nodeloc-flarum-ext-referral.key_count',\n      label: app.translator.trans('nodeloc-referral.admin.settings.key_count'),\n      type: 'number',\n    })\n    .registerPage(FreeListSettingPage)\n    .registerPermission(\n      {\n        icon: 'fas fa-money-bill',\n        label: app.translator.trans('nodeloc-referral.admin.permissions.referral_key'),\n        permission: 'user.referral_key',\n      },\n      'moderate',\n    );\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","FreeCodeListItem","_Model","_this","_len","arguments","length","args","Array","_key","apply","concat","days","Model","amount","group","SelectFieldOptionEditor","_proto","oninit","this","items","app","request","method","url","forum","attribute","then","response","store","pushPayload","m","redraw","view","_this2","existingGroups","map","item","id","LoadingIndicator","index","namePlural","type","min","step","onchange","event","save","target","onclick","preventDefault","splice","icon","colspan","Dropdown","label","translator","trans","translationPrefix","buttonClassName","all","filter","Group","indexOf","Button","body","data","attributes","groupId","push","FreeListSettingPage","_ExtensionPage","content","FreeListConfigurator","ExtensionPage","add","models","registerSetting","setting","registerPage","registerPermission","permission"],"sourceRoot":""}