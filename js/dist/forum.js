(()=>{var e={n:r=>{var t=r&&r.__esModule?()=>r.default:()=>r;return e.d(t,{a:t}),t},d:(r,t)=>{for(var o in t)e.o(t,o)&&!e.o(r,o)&&Object.defineProperty(r,o,{enumerable:!0,get:t[o]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},r={};(()=>{"use strict";e.r(r),e.d(r,{extend:()=>B});const t=flarum.core.compat["forum/app"];var o=e.n(t);const n=flarum.core.compat["common/extend"],a=flarum.core.compat["forum/components/IndexPage"];var c=e.n(a);const i=flarum.core.compat["common/components/LinkButton"];var s=e.n(i);const l=flarum.core.compat["common/extenders"];var u=e.n(l);function d(e,r){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e},d(e,r)}function p(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,d(e,r)}const f=flarum.core.compat["components/IndexPage"];var v=e.n(f);const _=flarum.core.compat["common/helpers/listItems"];var y=e.n(_);const h=flarum.core.compat["common/components/Button"];var b=e.n(h);const x=flarum.core.compat["common/components/Modal"];var g=e.n(x);const N=flarum.core.compat["common/utils/Stream"];var k=e.n(N),w=function(e){function r(){var r;return(r=e.call(this)||this).invite_code_price=o().forum.attribute("invite_code_price"),r.invite_code_reward=o().forum.attribute("invite_code_reward"),r.invite_code_max_number=o().forum.attribute("invite_code_max_number"),r.invite_code_expires=o().forum.attribute("invite_code_expires"),r.key_count=k()("0"),r}p(r,e);var t=r.prototype;return t.className=function(){return"store-buy Modal--small"},t.title=function(){return o().translator.trans("nodeloc-referral.forum.purchase_invite_code")},t.onsubmit=function(e){var r=this;e.preventDefault(),this.loading=!0,o().request({method:"POST",url:o().forum.attribute("apiUrl")+"/store/referral",body:{key_count:this.key_count()}}).then((function(e){r.loading=!1,e.error?o().alerts.show({type:"error"},e.error):(r.key_count("0"),r.hide(),m.route.set(m.route.get()))}))},t.content=function(){var e=this;return m("div",{className:"container buy-store-layer"},m("div",{className:"Form"},m("div",{className:"helpText"},o().translator.trans("nodeloc-referral.forum.purchase_help_tip",{invite_code_price:this.invite_code_price,invite_code_reward:this.invite_code_reward})),m("div",{className:"Form-group"},m("label",{for:"buy-store-to-mail"},o().translator.trans("nodeloc-referral.forum.purchase_invite_code",{invite_code_max_number:this.invite_code_max_number})),m("div",{className:"helpText"},o().translator.trans("nodeloc-referral.forum.purchase_expire_tip",{invite_code_expires:this.invite_code_expires})," "),m("input",{required:!0,id:"buy-store-to-mail",className:"FormControl",type:"number",bidi:this.key_count})),m(b(),{className:"Button Button--primary",type:"submit",loading:this.loading,onclick:function(r){return e.onsubmit(r)}},"购买")))},r}(g());const O=flarum.core.compat["common/components/LoadingIndicator"];var C=e.n(O);const I=flarum.core.compat["common/Component"];var P=e.n(I);const S=flarum.core.compat["common/components/Alert"];var T=e.n(S),j=function(e){function r(){return e.apply(this,arguments)||this}p(r,e);var t=r.prototype;return t.oninit=function(r){var t=this;e.prototype.oninit.call(this,r),o().setTitle(o().translator.trans("nodeloc-referral.forum.referral")),o().setTitleCount(0),o().forum.attribute("invite_code_price"),o().forum.attribute("invite_code_max_number"),o().forum.attribute("invite_code_expires"),o().request({method:"GET",url:o().forum.attribute("apiUrl")+"/store/referral/show"}).then((function(e){e.data&&(t.records=e,m.redraw())}))},t.view=function(){return m("div",{className:"IndexPage"},v().prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,y()(v().prototype.sidebarItems().toArray()))),m("div",{class:"StoreIndex"},m("div",{class:"container"},m("div",{class:"sideNavContainer"},m("div",{class:"StoreIndex-results sideNavOffset"},m(b(),{class:"Button Button--primary",onclick:function(){o().modal.show(w)}},o().translator.trans("nodeloc-referral.forum.purchase_invite_code")),m("div",{class:"StoreIndex-Body"},this.records?this.recordsContent():m(C(),null)))))))))},t.recordsContent=function(){return console.log("records:",this.records.data.attributes),this.records.data.attributes&&0!==this.records.data.attributes.length?m("div",{className:"ReferralHistoryContainer"},m("ul",null,this.records.data.attributes.map((function(e){return m("li",{key:e.id,className:"copyable-item",onclick:function(){return r=e.doorkey.key,(t=document.createElement("textarea")).value="https://www.nodeloc.com/auth/"+r,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),void o().alerts.show(T(),{type:"success"},"邀请码已复制到剪贴板");var r,t}},m("p",null," ",o().translator.trans("nodeloc-referral.forum.create_time"),": ",(r=e.created_at,new Date(r).toLocaleString())),m("p",null,o().translator.trans("nodeloc-referral.forum.invite_code"),": ",m("span",{className:"copyable"},e.doorkey.key)),m("p",null," ",o().translator.trans("nodeloc-referral.forum.count"),": ",e.key_count),m("p",null," ",o().translator.trans("nodeloc-referral.forum.cost"),": ",e.key_cost," 能量"),m("p",null," ",o().translator.trans("nodeloc-referral.forum.actives"),": ",e.actives),m("p",null," ",o().translator.trans("nodeloc-referral.forum.is_expire"),": ",e.is_expire?"是":"否"));var r})))):""},r}(P());const B=[(new(u().Routes)).add("nodeloc.referral.store.index","/store",j)];(0,n.extend)(c().prototype,"navItems",(function(e){e.add("referral-store",m(s(),{href:o().route("nodeloc.referral.store.index"),icon:"fas fa-share-alt"},o().translator.trans("nodeloc-referral.forum.referral")),0)}))})(),module.exports=r})();
//# sourceMappingURL=forum.js.map